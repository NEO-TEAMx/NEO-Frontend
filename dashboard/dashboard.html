<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Sharp:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">
  <link rel="stylesheet" href="dashboard.css">
  <!-- <link rel="stylesheet" type="text/css" href="../styles.css">  -->
  <link rel="stylesheet" href="sub-dashboard.css">
  <link rel="stylesheet" href="../assets/css/style.css">
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <title>Dashboard</title>
  <style>
     .error{
            color: rgb(207, 22, 22);
            margin-top: 5px;
        }
        .success{
            color: rgb(12, 56, 12);
            margin-top: 5px;
        }
  </style>

</head>

<body class="body">
  <div class="">
    <div class="hide">
      <div class="small-header">
        <div class="open" id="open-btn">
          <button id="open-menu-btn"><i class="uil uil-list-ui-alt"></i></button>
        </div>
      </div>
    </div>


    <div class="container">

      <aside>
        <div class="top">
          <div class="logo">
            <img src="../assets/images/neo-logo.png" alt="">
            <h2>NEO</h2>
          </div>

          <div class="close" id="close-btn">
            <button id="close-menu-btn"><i class="uil uil-times"></i></button>
          </div>
        </div>
        <div class="sidebar">

          <ul>
            <li class="active"><a href="dashboard.html"><i class="material-icons">dashboard</i>
                <h3>Dashboard</h3>
              </a></li>
            <li><a href="../index.html"><i class="material-icons">home</i>
                <h3>Home</h3>
              </a></li>
            <li><a href="hash.html"><i class="material-icons">attach_money</i>
                <h3>Buy Hash</h3>
              </a></li>
            <li><a href="swap.html"><i class="material-icons">autorenew</i>
                <h3> Swap</h3>
              </a></li>
            <li><a href="withdraw.html"><i class="material-icons">arrow_upward</i>
                <h3> Withdrawal</h3>
              </a></li>
            <li><a href="deposit.html"><i class="material-icons">credit_card</i>
                <h3>Deposit</h3>
              </a></li>
            <li><a href="faq.html"><i class="material-icons">help</i>
                <h3>FAQs</h3>
              </a></li>
            <li><a href="referral.html"><i class="material-icons">person_add</i>
                <h3>Referral</h3>
              </a></li>
            <li><a href="transaction.html"><i class="material-icons">history</i>
                <h3>Transaction History</h3>
              </a></li>
            <li onclick="logoutFunc()"><a><i class="material-icons">logout</i>
                <h3>Log Out</h3>
            </a></li>
          </ul>
        </div>
      </aside>

      <!------------------------------------------------ END OF ASIDE ------------------------------------------------------->

      <div id="errorMsg" class="error"></div>
      <div id="successMsg" class="success"></div>


      <main class="mining-section">
        <h2>DASHBOARD</h2>
        <div id="mining-container">
          <h3 style="  font-family: 'Times New Roman', Times, serif;">Mining</h3>
          <div class="progress-bar-container">
            <svg class="progress-bar" viewBox="0 0 100 100">
              <circle class="bg-circle" cx="50" cy="50" r="45" />
              <circle class="progress-circle" cx="50" cy="50" r="45" />
            </svg>
            <div class="progress-text">0%</div>
            <div class="timer-text">00:00:00</div>
          </div>

          <p>Yield Balance: <span id="balance">0</span> NEO</p>
          <button id="start-mining-btn" onclick="startMining()">Start Mining</button>
          <div class="top-left">
            <div>
              <h4>Hash Rate</h4>
            </div>
            <div>
              <p>0.00 NEO/Hr</p>
            </div>
          </div>
          <div class="top-right">
            <h4>Total Balance</h4>
            <p id="balance">$0:00</p>
          </div>
          <div class="swap-btn-container">
            <a href="swap.html" target="_blank">
              <button id="swap-btn">
                <i class="material-icons">autorenew</i>
                Swap
              </button>
            </a>
          </div>

        </div>

        <section class="price-chart-section" style="display: none;">
          <h4>ANC REAL TIME PRICE CHART</h4>
          <div class="responsive-container">
            <div id="price-chart-container"></div>
          </div>
        </section>



        <footer class="section-p1">
          <div class="col">
            <!-- <img class="logo" src="../material/Anchor logo2.jpg" alt=""> -->
            <h4>Contact</h4>
            <p><span><strong><i class="uil uil-envelope"></i></strong> </span><a
                href="mailto:Neo-protocol@mail.com">Neo-protocol@mail.com</a></p>
            <p> <span><strong><i class="uil uil-location-point"></i></strong></span> 562 Willingtom Road, Street 32, San
              Francisco</p>
            <p><span><strong><i class="uil uil-clock-nine"></i></strong> </span> 10:00 - 18:00, Mon - Sat</p>
            <div class="follow">
              <h4>Follow Us On</h4>
              <div class="icon">
                <a href=" https://twitter.com/@Neo_Blockchain" target="_blank"><i class="uil uil-twitter-alt"></i></a>
                <a href=" https://linkedin.com" target="_blank"><i class="uil uil-linkedin-alt"></i></a>
                <a href=" https://youtube.com" target="_blank"><i class="uil uil-youtube"></i></a>

              </div>
            </div>
          </div>

          <div class="col">
            <h4>About</h4>
            <a href="#">Contact Us</a>
          </div>

          <div class="col">
            <h4>My Account</h4>
            <a href="../html/index.html">Sign Out</a>
            <a href="#">Help</a>
          </div>
          <div class="col install">
            <h4>Install App</h4>
            <p></p>
            <p>Coming Soon To App Store &amp Google Play!!</p>
            <div class="row">
              <a href="#"> <img src="../assets/images/app_store.svg" alt=""></a>
              <a href="#"><img src="../assets/images/google_play.svg" alt=""></a>

            </div>
          </div>

          <div class="copyright">
            <p> Â© <span id="currentYear"></span> Neo-Protocol, All Rights Resrerved.</p>
          </div>
        </footer>

        
        <script>


          // TradingView widget initialization
          new TradingView.widget(
            {
              "width": 360,
              "height": 400,
              "symbol": "KUCOIN:ANCUSDT",
              "interval": "1",
              "timezone": "Etc/UTC",
              "theme": "dark",
              "style": "1",
              "locale": "en",
              "toolbar_bg": "#f1f3f6",
              "enable_publishing": false,
              "allow_symbol_change": true,
              "container_id": "price-chart-container",

              "overrides": {
                "paneProperties.background": "#1b1b1b",
                "paneProperties.vertGridProperties.color": "#363c4e",
                "paneProperties.horzGridProperties.color": "#363c4e",
                "scalesProperties.textColor": "#8b949e",
                "mainSeriesProperties.candleStyle.upColor": "#00d395",
                "mainSeriesProperties.candleStyle.downColor": "#ff4d61",
                "mainSeriesProperties.candleStyle.drawWick": true,
                "mainSeriesProperties.candleStyle.drawBorder": true,
                "mainSeriesProperties.candleStyle.borderColor": "#378658",
                "mainSeriesProperties.candleStyle.borderUpColor": "#00d395",
                "mainSeriesProperties.candleStyle.borderDownColor": "#ff4d61",
              },
              "studies": [
                {
                  "id": "custom_indicator",
                  "script": "var signals = [1, 0, -1, 1, -1, 0, 1, -1, 0, 1];\n\nvar upSignal = signals.map((signal, index) => signal === 1 ? { time: index, position: 'aboveBar', color: 'green', text: 'Buy' } : null);\n\nvar downSignal = signals.map((signal, index) => signal === -1 ? { time: index, position: 'belowBar', color: 'red', text: 'Sell' } : null);\n\nupSignal = upSignal.filter(Boolean);\ndownSignal = downSignal.filter(Boolean);\n\nvar signalsArray = upSignal.concat(downSignal);\n\nvar signalsOutput = [];\n\nif (signalsArray.length > 0) {\n  signalsArray.forEach(function (signal) {\n    signalsOutput.push({ time: signal.time, position: signal.position, color: signal.color, shape: 'arrow_up', text: signal.text });\n  });\n}\n\nsignalsOutput",
                  "inputs": [],
                  "styles": [
                    {
                      "id": "color",
                      "color": "#ffffff"
                    }
                  ]
                }
              ]
            }

          );
        </script>


      </main>

      <script>

        const MINING_DURATION_SECONDS = 24 * 60 * 60; // 1 day in seconds
        const PROGRESS_UPDATE_INTERVAL_MS = 1000; // Progress update interval in milliseconds

        let progress = 0;
        let progressInterval = null;
        let balance = 0;

        // Retrieve the progress and balance from Local Storage
        const storedProgress = localStorage.getItem('progress');
        const storedBalance = localStorage.getItem('balance');

        // Check if progress and balance data exist and update the display
        if (storedProgress && storedBalance) {
          progress = parseFloat(storedProgress);
          balance = parseFloat(storedBalance);
          updateProgressBar();
          updateBalance();
        }

        function startMining() {
          // Check if mining is already in progress
          if (progressInterval !== null) {
            return;
          }

          const progressCircle = document.querySelector('.progress-circle');
          const progressText = document.querySelector('.progress-text');
          const balanceElement = document.querySelector('#balance');
          const startMiningBtn = document.querySelector('#start-mining-btn');
          const timerText = document.querySelector('.timer-text'); // Timer element

          const startTime = Date.now();
          const endTime = startTime + MINING_DURATION_SECONDS * 1000;

          // Update button text and disable it during mining
          startMiningBtn.textContent = 'Currently Mining';
          startMiningBtn.disabled = true;

          progressInterval = setInterval(() => {
            const currentTime = Date.now();
            const elapsedTime = currentTime - startTime;
            const remainingTime = Math.max(0, endTime - currentTime); // Remaining time in milliseconds

            if (currentTime >= endTime) {
              clearInterval(progressInterval);
              progressInterval = null;
              progressCircle.style.strokeDasharray = `100, 100`;
              progressText.textContent = `100%`;
              timerText.textContent = '00:00:00'; // Set timer text to 00:00:00

              // Update button text and enable it after mining
              startMiningBtn.textContent = 'Start Mining';
              startMiningBtn.disabled = false;

              // Clear progress and balance from Local Storage
              localStorage.removeItem('progress');
              localStorage.removeItem('balance');

              return;
            }

            progress = (elapsedTime / (MINING_DURATION_SECONDS * 1000)) * 100;
            updateProgressBar();

            // Update balance display
            balance += 0.5; // Example: Increment balance by 0.5 USDT per interval
            updateBalance();

            // Update timer text
            const formattedTime = formatTime(remainingTime);
            timerText.textContent = formattedTime;

            // Store the progress and balance in Local Storage
            localStorage.setItem('progress', progress.toFixed(2));
            localStorage.setItem('balance', balance.toFixed(2));
          }, PROGRESS_UPDATE_INTERVAL_MS);
        }

        function updateProgressBar() {
          const progressCircle = document.querySelector('.progress-circle');
          const progressText = document.querySelector('.progress-text');
          progressCircle.style.strokeDasharray = `${progress}, 100`;
          progressText.textContent = `${Math.round(progress)}%`;
        }

        function updateBalance() {
          const balanceElement = document.querySelector('#balance');
          balanceElement.textContent = balance.toFixed(2);
        }

        // Format time in HH:MM:SS format
        function formatTime(milliseconds) {
          const seconds = Math.floor(milliseconds / 1000);
          const minutes = Math.floor(seconds / 60);
          const hours = Math.floor(minutes / 60);

          const formattedHours = padZero(hours);
          const formattedMinutes = padZero(minutes % 60);
          const formattedSeconds = padZero(seconds % 60);

          return `${formattedHours}:${formattedMinutes}:${formattedSeconds}`;
        }

        // Add leading zero if the number is less than 10
        function padZero(number) {
          return number < 10 ? `0${number}` : `${number}`;
        }

        // Attach event listener to start mining button
        const startMiningBtn = document.querySelector('#start-mining-btn');
        startMiningBtn.addEventListener('click', startMining);

        // Start mining if progress and balance are available
        if (progress > 0 && balance > 0) {
          startMining();
        }

      </script>


      <script>
        const sideMenu = document.querySelector("aside");
        const menuBtn = document.querySelector("#open-menu-btn")
        const closeBtn = document.querySelector("#close-btn")

        menuBtn.addEventListener('click', () => {
          sideMenu.style.display = "block";
        });

        closeBtn.addEventListener('click', () => {
          sideMenu.style.display = "none";
        });


      </script>

    </div>
  </div>
  <script>
    const baseUrl = 'http://localhost:4040/api/v1/';

    async function logoutFunc(){
      try {
        console.log('Clicked')
        const response = await fetch(baseUrl+'logout', {
          method: 'DELETE',
        });
        const data = await response.json()
        console.log(data)
      } catch (error) {
        console.log(error);
      }
      // console.log('Clicked')
    }
  </script>
  <script src="../assets/js/main.browser.js"></script>
  <script src="../assets/js/index.page.js"></script>
  <script src="../assets/js/dashboard.js"></script>
</body>

</html>